<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•ì˜ ì‹œê°„í‘œ ë° ì¥ì†Œ ê²€ìƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        .filter-group select {
            padding: 10px 15px;
            font-size: 1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
            min-width: 150px;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-box {
            margin-bottom: 30px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: border-color 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-box::after {
            content: 'ğŸ”';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
        }

        .clear-btn {
            position: absolute;
            right: 60px;
            top: 50%;
            transform: translateY(-50%);
            background: #ddd;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.9em;
            display: none;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .clear-btn:hover {
            background: #bbb;
        }

        .clear-btn.show {
            display: flex;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .schedule-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .schedule-table td {
            padding: 12px;
            border: 1px solid #e0e0e0;
            vertical-align: top;
            min-height: 100px;
        }

        .schedule-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .schedule-table tr:hover {
            background: #f0f0f0;
        }

        .room-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .room-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            min-width: 100px;
        }

        .room-table td {
            padding: 15px;
            border: 2px solid #e0e0e0;
            text-align: center;
            vertical-align: top;
            min-height: 80px;
            position: relative;
        }

        .room-table td.has-class {
            background: #fff3cd;
            cursor: pointer;
        }

        .room-table td.has-class:hover {
            background: #ffe69c;
        }

        .room-number {
            font-weight: bold;
            font-size: 0.85em;
            color: #333;
            margin-bottom: 6px;
        }

        .class-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .class-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .class-name {
            font-size: 0.95em;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .class-info {
            color: #666;
            font-size: 0.75em;
            line-height: 1.4;
        }

        .class-info span {
            display: inline-block;
            margin-right: 8px;
        }

        .class-meta {
            font-size: 0.7em;
            color: #888;
            margin-top: 3px;
        }

        .location {
            color: #667eea;
            font-weight: 600;
            font-size: 0.7em;
        }

        .time {
            color: #764ba2;
            font-weight: 600;
            font-size: 0.7em;
        }

        .professor {
            color: #555;
            font-size: 0.7em;
        }

        .professor-name {
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .professor-name:hover {
            color: #764ba2;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: #999;
            font-size: 1.2em;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #667eea;
        }

        .stats {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            color: #666;
        }

        .time-header {
            background: #f8f8f8;
            font-weight: 600;
            text-align: center;
            width: 80px;
        }

        .empty-cell {
            min-height: 50px;
        }

        .row-header {
            background: #f8f8f8;
            font-weight: 600;
            text-align: center;
            width: 60px;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
            font-size: 1.8em;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover,
        .close:focus {
            color: #000;
        }

        .room-detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .room-detail-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
        }

        .room-detail-table td {
            padding: 10px;
            border: 1px solid #e0e0e0;
            vertical-align: top;
            font-size: 0.85em;
        }

        .room-detail-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .room-detail-class-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
            font-size: 0.8em;
        }

        .room-detail-class-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        .room-detail-class-meta {
            font-size: 0.75em;
            color: #888;
            margin-bottom: 3px;
        }

        .room-detail-class-info {
            font-size: 0.7em;
            color: #666;
        }

        #schedule-content {
            overflow-x: scroll;
        }

        .room-table {
            overflow-x: scroll;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ê°•ì˜ ì‹œê°„í‘œ ë° ì¥ì†Œ ê²€ìƒ‰</h1>
            <p>ê±´ë¬¼ê³¼ êµì‹œë¥¼ ì„ íƒí•˜ë©´ ê°•ì˜ì‹¤ ë°°ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            <p>í•¸ë“œí° í™˜ê²½ì—ì„œëŠ” ì œëŒ€ë¡œ ë³´ì´ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="content">
            <!-- ê±´ë¬¼ ë° êµì‹œ ì„ íƒ -->
            <div class="filter-section">
                <div class="filter-group">
                    <label for="building-select">ê±´ë¬¼ ì„ íƒ</label>
                    <select id="building-select" onchange="updateRoomTable()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="day-select">ìš”ì¼ ì„ íƒ</label>
                    <select id="day-select" onchange="updateRoomTable()">
                        <option value="">ì „ì²´</option>
                        <option value="ì›”">ì›”ìš”ì¼</option>
                        <option value="í™”">í™”ìš”ì¼</option>
                        <option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
                        <option value="ëª©">ëª©ìš”ì¼</option>
                        <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="period-select">êµì‹œ ì„ íƒ</label>
                    <select id="period-select" onchange="updateRoomTable()">
                        <option value="">ì „ì²´</option>
                        <option value="1">1êµì‹œ</option>
                        <option value="2">2êµì‹œ</option>
                        <option value="3">3êµì‹œ</option>
                        <option value="4">4êµì‹œ</option>
                        <option value="5">5êµì‹œ</option>
                        <option value="6">6êµì‹œ</option>
                        <option value="7">7êµì‹œ</option>
                        <option value="8">8êµì‹œ</option>
                        <option value="9">9êµì‹œ</option>
                        <option value="10">10êµì‹œ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="major-select">ì „ê³µ ì½”ë“œ</label>
                    <select id="major-select" onchange="updateRoomTable()">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
            </div>

            <!-- ê¸°ì¡´ ê²€ìƒ‰ ê¸°ëŠ¥ -->
            <div class="search-box">
                <input type="text" id="location-search" placeholder="ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë¹„501, ëˆ„403)" onkeyup="filterSchedule()" oninput="toggleClearBtn()">
                <button class="clear-btn" id="clear-btn" onclick="clearSearch()">âœ•</button>
            </div>
            <div class="stats" id="stats"></div>
            <div id="schedule-content" class="loading" style="overflow-y: auto;">ì‹œê°„í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <!-- ê°•ì˜ì‹¤ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="roomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalRoomName">ê°•ì˜ì‹¤ ìƒì„¸ ì •ë³´</h2>
                <span class="close" onclick="closeRoomModal()">&times;</span>
            </div>
            <div id="modalRoomContent"></div>
        </div>
    </div>

    <!-- êµìˆ˜ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="professorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalProfessorName">êµìˆ˜ ìƒì„¸ ì •ë³´</h2>
                <span class="close" onclick="closeProfessorModal()">&times;</span>
            </div>
            <div id="modalProfessorContent"></div>
        </div>
    </div>

    <script>
        let classData = [];
        const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
        const maxPeriod = 12; // ìµœëŒ€ êµì‹œ ìˆ˜
        let buildings = new Set();
        let majorCodes = new Set();
        let viewMode = 'schedule'; // 'schedule' or 'room'

        // JSON íŒŒì¼ ë¡œë“œ
        async function loadData() {
            try {
                const response = await fetch('class_list.json');
                classData = await response.json();
                
                // ê±´ë¬¼ ëª©ë¡ ì¶”ì¶œ
                extractBuildings();
                populateBuildingSelect();
                // ì „ê³µ ì½”ë“œ ëª©ë¡ ì¶”ì¶œ
                extractMajorCodes();
                populateMajorSelect();
                renderSchedule();
            } catch (error) {
                document.getElementById('schedule-content').innerHTML = 
                    '<div class="no-results">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error loading data:', error);
            }
        }

        // ê±´ë¬¼ ëª©ë¡ ì¶”ì¶œ (locHnameì—ì„œ ì²« ê¸€ì ì¶”ì¶œ)
        function extractBuildings() {
            buildings.clear();
            classData.forEach(cls => {
                cls.rooms.forEach(room => {
                    if (room.locHname) {
                        // í•œê¸€ ê±´ë¬¼ëª… ì¶”ì¶œ (ì˜ˆ: "ë¹„501" -> "ë¹„", "í•œìš¸B102" -> "í•œìš¸")
                        const match = room.locHname.match(/^([ê°€-í£]+)/);
                        if (match) {
                            buildings.add(match[1]);
                        }
                    }
                });
            });
        }

        // ê±´ë¬¼ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
        function populateBuildingSelect() {
            const select = document.getElementById('building-select');
            const sortedBuildings = Array.from(buildings).sort();
            sortedBuildings.forEach(building => {
                const option = document.createElement('option');
                option.value = building;
                option.textContent = building;
                select.appendChild(option);
            });
        }

        // ì „ê³µ ì½”ë“œ ëª©ë¡ ì¶”ì¶œ
        function extractMajorCodes() {
            majorCodes.clear();
            classData.forEach(cls => {
                if (cls.openMajorCode) {
                    majorCodes.add(cls.openMajorCode);
                }
            });
        }

        // ì „ê³µ ì½”ë“œ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
        function populateMajorSelect() {
            const select = document.getElementById('major-select');
            const sortedMajorCodes = Array.from(majorCodes).sort();
            sortedMajorCodes.forEach(majorCode => {
                const option = document.createElement('option');
                option.value = majorCode;
                option.textContent = majorCode;
                select.appendChild(option);
            });
        }

        // ê°•ì˜ì‹¤ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateRoomTable() {
            const building = document.getElementById('building-select').value;
            const day = document.getElementById('day-select').value;
            const period = document.getElementById('period-select').value;
            const majorCode = document.getElementById('major-select').value;
            
            if (!building) {
                // ê±´ë¬¼ì´ ì„ íƒë˜ì§€ ì•Šìœ¼ë©´ ê¸°ì¡´ ì‹œê°„í‘œ í‘œì‹œ
                viewMode = 'schedule';
                filterSchedule();
                return;
            }

            viewMode = 'room';
            renderRoomTable(building, day || null, period ? parseInt(period) : null, majorCode || null);
        }

        // ê°•ì˜ì‹¤ í…Œì´ë¸” ë Œë”ë§
        function renderRoomTable(building, day = null, period = null, majorCode = null) {
            const scheduleContent = document.getElementById('schedule-content');
            const statsDiv = document.getElementById('stats');

            // í•´ë‹¹ ê±´ë¬¼ì˜ ê°•ì˜ì‹¤ ë°ì´í„° ìˆ˜ì§‘
            const roomData = new Map(); // key: "ì¸µ|í˜¸ìˆ˜", value: ê°•ì˜ ëª©ë¡

            classData.forEach(cls => {
                // ì „ê³µ ì½”ë“œ í•„í„° í™•ì¸
                if (majorCode !== null && cls.openMajorCode !== majorCode) {
                    return;
                }

                cls.rooms.forEach(room => {
                    if (room.locHname && room.locHname.startsWith(building)) {
                        // ìš”ì¼ í•„í„° í™•ì¸
                        if (day !== null && room.dayname1 !== day) {
                            return;
                        }

                        // êµì‹œ í•„í„° í™•ì¸
                        if (period !== null) {
                            const matchesPeriod = room.timeNo1 === period || 
                                                 room.timeNo2 === period || 
                                                 room.timeNo3 === period || 
                                                 room.timeNo4 === period;
                            if (!matchesPeriod) return;
                        }

                        // í˜¸ìˆ˜ì—ì„œ ì¸µê³¼ í˜¸ ì¶”ì¶œ
                        // ì˜ˆ: "B101" -> ì§€í•˜1ì¸µ, 1ì—´ / "1007" -> 10ì¸µ, 7ì—´ / "302" -> 3ì¸µ, 2ì—´
                        const roomNumber = room.locHname.substring(building.length);
                        let floor = null;
                        let col = null;
                        
                        // Bë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° (ì§€í•˜ì¸µ) - ì˜ˆ: "B101", "B102"
                        if (roomNumber.match(/^B/i)) {
                            const match = roomNumber.match(/^B(\d)(\d{2})$/i);
                            if (match) {
                                const floorNum = parseInt(match[1]);
                                const colNum = parseInt(match[2]);

                                if (floorNum > 0 && colNum > 0) {
                                    floor = -floorNum; // ìŒìˆ˜ë¡œ ì§€í•˜ì¸µ í‘œì‹œ
                                    col = colNum;
                                }
                                
                            }
                        } 
                        // ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°
                        else {
                            // 10XX í˜•ì‹ (10ì¸µ) - ì˜ˆ: "1007"
                            const match10 = roomNumber.match(/^10(\d{2})$/);
                            if (match10) {
                                const colNum = parseInt(match10[1]);
                                if (colNum > 0) {
                                    floor = 10;
                                    col = colNum;
                                }
                            }
                            // 1-9XX í˜•ì‹ (1-9ì¸µ) - ì˜ˆ: "302", "501"
                            else {
                                const match = roomNumber.match(/^(\d)(\d{2})$/);
                                if (match) {
                                    const floorNum = parseInt(match[1]);
                                    const colNum = parseInt(match[2]);
                                    // 0ì¸µì€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì œì™¸
                                    if (floorNum > 0 && colNum > 0) {
                                        floor = floorNum;
                                        col = colNum;
                                    }
                                }
                            }
                        }
                        
                        if (floor !== null && col !== null && floor !== 0 && col > 0) {
                            const key = `${floor}|${col}`;
                            
                            if (!roomData.has(key)) {
                                roomData.set(key, []);
                            }
                            roomData.get(key).push({
                                class: cls,
                                room: room,
                                roomNumber: room.locHname
                            });
                        }
                    }
                });
            });

            // í†µê³„ ì •ë³´
            const dayText = day ? `${day}ìš”ì¼ ` : '';
            const periodText = period ? `${period}êµì‹œ ` : '';
            const majorText = majorCode ? `[${majorCode}] ` : '';
            statsDiv.textContent = `${building} ê±´ë¬¼ ${majorText}${dayText}${periodText}ê°•ì˜ì‹¤ ë°°ì¹˜ (ì´ ${roomData.size}ê°œ ê°•ì˜ì‹¤ ì‚¬ìš© ì¤‘)`;

            // ìµœì†Œ/ìµœëŒ€ ì¸µìˆ˜ì™€ ì—´ ì°¾ê¸°
            let minFloor = Infinity;
            let maxFloor = -Infinity;
            let maxCol = 0;
            roomData.forEach((classes, key) => {
                const [floor, col] = key.split('|').map(Number);
                minFloor = Math.min(minFloor, floor);
                maxFloor = Math.max(maxFloor, floor);
                maxCol = Math.max(maxCol, col);
            });

            if (maxFloor === -Infinity || maxCol === 0) {
                scheduleContent.innerHTML = '<div class="no-results">ì„ íƒí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ê°•ì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // í…Œì´ë¸” ìƒì„± (ì—´ì€ 1ë¶€í„° ì‹œì‘)
            let html = '<table class="room-table"><thead><tr><th>ì¸µ/ì—´</th>';
            for (let c = 1; c <= maxCol; c++) {
                html += `<th>${c}ì—´</th>`;
            }
            html += '</tr></thead><tbody>';

            // ê° ì¸µë³„ë¡œ í–‰ ìƒì„± (ì§€í•˜ì¸µë¶€í„° ì§€ìƒì¸µ ìˆœì„œ)
            for (let floor = minFloor; floor <= maxFloor; floor++) {
                // 0ì¸µì€ ê±´ë„ˆë›°ê¸° (0ì¸µì€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ)
                if (floor === 0) continue;
                
                let floorLabel = '';
                if (floor < 0) {
                    floorLabel = `ì§€í•˜${Math.abs(floor)}ì¸µ`;
                } else {
                    floorLabel = `${floor}ì¸µ`;
                }
                html += `<tr><td class="row-header">${floorLabel}</td>`;
                for (let col = 1; col <= maxCol; col++) {
                    const key = `${floor}|${col}`;
                    const classes = roomData.get(key) || [];
                    
                    if (classes.length > 0) {
                        html += '<td class="has-class" onclick="showRoomDetail(\'' + building + '\', \'' + classes[0].roomNumber + '\')">';
                        // ì‹¤ì œ í˜¸ìˆ˜ ì°¾ê¸°
                        const firstClass = classes[0];
                        html += `<div class="room-number">${firstClass.roomNumber}</div>`;
                        classes.forEach(item => {
                            html += renderRoomClassItem(item.class, item.room);
                        });
                        html += '</td>';
                    } else {
                        html += '<td></td>';
                    }
                }
                html += '</tr>';
            }

            html += '</tbody></table>';
            scheduleContent.innerHTML = html;
        }

        // ê°•ì˜ì‹¤ í…Œì´ë¸”ìš© ê°•ì˜ ì•„ì´í…œ ë Œë”ë§
        function renderRoomClassItem(cls, room) {
            const periods = [];
            if (room.timeNo1) periods.push(room.timeNo1);
            if (room.timeNo2) periods.push(room.timeNo2);
            if (room.timeNo3) periods.push(room.timeNo3);
            if (room.timeNo4) periods.push(room.timeNo4);
            const timeStr = periods.sort((a,b) => a-b).join(',') + 'êµì‹œ';
            const grade = cls.openGrade || '';
            const codeName = cls.codeName1 || '';
            const professorName = cls.memberName || 'ë¯¸ì •';
            const stuCount = cls.sugangCount || 'íê°•';
            const professorDisplay = professorName !== 'ë¯¸ì •' 
                ? `<span class="professor-name" onclick="showProfessorDetail('${professorName.replace(/'/g, "\\'")}')">${professorName}</span>`
                : professorName;

            return `
                <div class="class-item">
                    <div class="class-name">${cls.gwamokKname} (${professorDisplay})</div>
                    <div class="class-meta">${grade}í•™ë…„ ${codeName} (${stuCount}ëª…)</div>
                    <div class="class-info">
                        <span class="time">â° ${room.dayname1} ${timeStr}</span>
                    </div>
                </div>
            `;
        }

        // ê²€ìƒ‰ì°½ ì§€ìš°ê¸° ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
        function toggleClearBtn() {
            const searchInput = document.getElementById('location-search');
            const clearBtn = document.getElementById('clear-btn');
            if (searchInput.value.trim()) {
                clearBtn.classList.add('show');
            } else {
                clearBtn.classList.remove('show');
            }
        }

        // ê²€ìƒ‰ì°½ ì§€ìš°ê¸°
        function clearSearch() {
            document.getElementById('location-search').value = '';
            document.getElementById('clear-btn').classList.remove('show');
            filterSchedule();
        }

        // ì¥ì†Œë¡œ í•„í„°ë§ëœ ì‹œê°„í‘œ ë Œë”ë§
        function filterSchedule() {
            const searchTerm = document.getElementById('location-search').value.trim().toLowerCase();
            viewMode = 'schedule';
            renderSchedule(searchTerm);
        }

        // ì‹œê°„í‘œ ë Œë”ë§
        function renderSchedule(locationFilter = '') {
            const scheduleContent = document.getElementById('schedule-content');
            const statsDiv = document.getElementById('stats');
            
            // í•„í„°ë§ëœ ë°ì´í„°
            let filteredData = classData;
            if (locationFilter) {
                filteredData = classData.filter(cls => {
                    return cls.rooms.some(room => 
                        room.locHname && room.locHname.toLowerCase().includes(locationFilter)
                    );
                });
            }

            // í†µê³„ ì •ë³´
            if (locationFilter) {
                statsDiv.textContent = `"${locationFilter}" ê²€ìƒ‰ ê²°ê³¼: ${filteredData.length}ê°œì˜ ê°•ì˜ê°€ ìˆìŠµë‹ˆë‹¤.`;
            } else {
                statsDiv.textContent = `ì´ ${classData.length}ê°œì˜ ê°•ì˜ê°€ ìˆìŠµë‹ˆë‹¤.`;
            }

            // ì‹œê°„í‘œ í…Œì´ë¸” ìƒì„±
            let html = '<table class="schedule-table"><thead><tr><th>êµì‹œ</th>';
            days.forEach(day => {
                html += `<th>${day}ìš”ì¼</th>`;
            });
            html += '</tr></thead><tbody>';

            // ê° êµì‹œë³„ë¡œ í–‰ ìƒì„±
            for (let period = 1; period <= maxPeriod; period++) {
                html += `<tr><td class="time-header">${period}êµì‹œ</td>`;
                
                // ê° ìš”ì¼ë³„ë¡œ ì…€ ìƒì„±
                days.forEach(day => {
                    html += '<td>';
                    const classes = getClassesByDayAndPeriod(filteredData, day, period, locationFilter);
                    if (classes.length === 0) {
                        html += '<div class="empty-cell"></div>';
                    } else {
                        classes.forEach(cls => {
                            html += renderClassItem(cls, day, period);
                        });
                    }
                    html += '</td>';
                });
                
                html += '</tr>';
            }

            html += '</tbody></table>';
            scheduleContent.innerHTML = html;
        }

        // íŠ¹ì • ìš”ì¼ê³¼ êµì‹œì˜ ê°•ì˜ ê°€ì ¸ì˜¤ê¸°
        function getClassesByDayAndPeriod(data, day, period, locationFilter) {
            return data.filter(cls => {
                return cls.rooms.some(room => {
                    if (room.dayname1 !== day) return false;
                    
                    // êµì‹œ í™•ì¸
                    const matchesPeriod = room.timeNo1 === period || 
                                         room.timeNo2 === period || 
                                         room.timeNo3 === period || 
                                         room.timeNo4 === period;
                    
                    if (!matchesPeriod) return false;
                    
                    // ì¥ì†Œ í•„í„°ê°€ ìˆìœ¼ë©´ ì¥ì†Œë„ í™•ì¸
                    if (locationFilter) {
                        return room.locHname && room.locHname.toLowerCase().includes(locationFilter);
                    }
                    
                    return true;
                });
            });
        }

        // ê°•ì˜ ì•„ì´í…œ ë Œë”ë§
        function renderClassItem(cls, day, period) {
            const room = cls.rooms.find(r => r.dayname1 === day && 
                (r.timeNo1 === period || r.timeNo2 === period || 
                 r.timeNo3 === period || r.timeNo4 === period));
            
            if (!room) return '';
            
            const periods = [];
            if (room.timeNo1) periods.push(room.timeNo1);
            if (room.timeNo2) periods.push(room.timeNo2);
            if (room.timeNo3) periods.push(room.timeNo3);
            if (room.timeNo4) periods.push(room.timeNo4);
            const timeStr = periods.sort((a,b) => a-b).join(',') + 'êµì‹œ';
            const stuCount = cls.sugangCount || 'íê°•';
            const grade = cls.openGrade || '';
            const codeName = cls.codeName1 || '';
            const professorName = cls.memberName || 'ë¯¸ì •';
            const professorDisplay = professorName !== 'ë¯¸ì •' 
                ? `<span class="professor-name" onclick="showProfessorDetail('${professorName.replace(/'/g, "\\'")}')">${professorName}</span>`
                : professorName;

            return `
                <div class="class-item">
                    <div class="class-name">${cls.gwamokKname} (${professorDisplay})</div>
                    <div class="class-meta">${grade}í•™ë…„ ${codeName} (${stuCount}ëª…) </div>
                    <div class="class-info">
                        <span class="location">ğŸ“ ${room.locHname}</span>
                        <span class="time">â° ${timeStr}</span>
                    </div>
                </div>
            `;
        }

        // ê°•ì˜ì‹¤ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showRoomDetail(building, roomNumber) {
            const modal = document.getElementById('roomModal');
            const modalRoomName = document.getElementById('modalRoomName');
            const modalRoomContent = document.getElementById('modalRoomContent');
            
            modalRoomName.textContent = `${roomNumber} ê°•ì˜ì‹¤ ìƒì„¸ ì •ë³´`;
            
            // í•´ë‹¹ ê°•ì˜ì‹¤ì˜ ëª¨ë“  ê°•ì˜ ìˆ˜ì§‘
            const roomClasses = [];
            classData.forEach(cls => {
                cls.rooms.forEach(room => {
                    if (room.locHname === roomNumber) {
                        roomClasses.push({
                            class: cls,
                            room: room
                        });
                    }
                });
            });

            if (roomClasses.length === 0) {
                modalRoomContent.innerHTML = '<div class="no-results">ì´ ê°•ì˜ì‹¤ì— ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                modal.style.display = 'block';
                return;
            }

            // ìš”ì¼ë³„, êµì‹œë³„ë¡œ ì •ë¦¬
            const scheduleData = {};
            days.forEach(day => {
                scheduleData[day] = {};
                for (let period = 1; period <= maxPeriod; period++) {
                    scheduleData[day][period] = [];
                }
            });

            roomClasses.forEach(item => {
                const room = item.room;
                const day = room.dayname1;
                if (day && scheduleData[day]) {
                    if (room.timeNo1) scheduleData[day][room.timeNo1].push(item);
                    if (room.timeNo2) scheduleData[day][room.timeNo2].push(item);
                    if (room.timeNo3) scheduleData[day][room.timeNo3].push(item);
                    if (room.timeNo4) scheduleData[day][room.timeNo4].push(item);
                }
            });

            // ì‹œê°„í‘œ ìƒì„±
            let html = '<table class="room-detail-table"><thead><tr><th>êµì‹œ</th>';
            days.forEach(day => {
                html += `<th>${day}ìš”ì¼</th>`;
            });
            html += '</tr></thead><tbody>';

            for (let period = 1; period <= maxPeriod; period++) {
                html += `<tr><td class="time-header" style="background: #f8f8f8; font-weight: 600; text-align: center;">${period}êµì‹œ</td>`;
                days.forEach(day => {
                    html += '<td>';
                    const classes = scheduleData[day][period] || [];
                    if (classes.length > 0) {
                        classes.forEach(item => {
                            html += renderRoomDetailClassItem(item.class, item.room, period);
                        });
                    }
                    html += '</td>';
                });
                html += '</tr>';
            }

            html += '</tbody></table>';
            modalRoomContent.innerHTML = html;
            modal.style.display = 'block';
        }

        // ê°•ì˜ì‹¤ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeRoomModal() {
            document.getElementById('roomModal').style.display = 'none';
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const roomModal = document.getElementById('roomModal');
            const professorModal = document.getElementById('professorModal');
            if (event.target == roomModal) {
                roomModal.style.display = 'none';
            }
            if (event.target == professorModal) {
                professorModal.style.display = 'none';
            }
        }

        // ê°•ì˜ì‹¤ ìƒì„¸ ì‹œê°„í‘œìš© ê°•ì˜ ì•„ì´í…œ ë Œë”ë§
        function renderRoomDetailClassItem(cls, room, period) {
            const periods = [];
            if (room.timeNo1) periods.push(room.timeNo1);
            if (room.timeNo2) periods.push(room.timeNo2);
            if (room.timeNo3) periods.push(room.timeNo3);
            if (room.timeNo4) periods.push(room.timeNo4);
            const timeStr = periods.sort((a,b) => a-b).join(',') + 'êµì‹œ';
            const stuCount = cls.sugangCount || 'íê°•';
            const grade = cls.openGrade || '';
            const codeName = cls.codeName1 || '';
            const professorName = cls.memberName || 'ë¯¸ì •';
            const professorDisplay = professorName !== 'ë¯¸ì •' 
                ? `<span class="professor-name" onclick="showProfessorDetail('${professorName.replace(/'/g, "\\'")}')">${professorName}</span>`
                : professorName;

            return `
                <div class="room-detail-class-item">
                    <div class="room-detail-class-name">${cls.gwamokKname} (${professorDisplay})</div>
                    <div class="room-detail-class-meta">${grade}í•™ë…„ ${codeName} (${stuCount}ëª…)</div>
                    <div class="room-detail-class-info">${timeStr}</div>
                </div>
            `;
        }

        // êµìˆ˜ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showProfessorDetail(professorName) {
            const modal = document.getElementById('professorModal');
            const modalProfessorName = document.getElementById('modalProfessorName');
            const modalProfessorContent = document.getElementById('modalProfessorContent');
            
            modalProfessorName.textContent = `${professorName} êµìˆ˜ë‹˜ ê°•ì˜ ëª©ë¡`;
            
            // í•´ë‹¹ êµìˆ˜ì˜ ëª¨ë“  ê°•ì˜ ìˆ˜ì§‘
            const professorClasses = [];
            classData.forEach(cls => {
                if (cls.memberName === professorName) {
                    cls.rooms.forEach(room => {
                        professorClasses.push({
                            class: cls,
                            room: room
                        });
                    });
                }
            });

            if (professorClasses.length === 0) {
                modalProfessorContent.innerHTML = '<div class="no-results">ë“±ë¡ëœ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                modal.style.display = 'block';
                return;
            }

            // ìš”ì¼ë³„, êµì‹œë³„ë¡œ ì •ë¦¬
            const scheduleData = {};
            days.forEach(day => {
                scheduleData[day] = {};
                for (let period = 1; period <= maxPeriod; period++) {
                    scheduleData[day][period] = [];
                }
            });

            professorClasses.forEach(item => {
                const room = item.room;
                const day = room.dayname1;
                if (day && scheduleData[day]) {
                    if (room.timeNo1) scheduleData[day][room.timeNo1].push(item);
                    if (room.timeNo2) scheduleData[day][room.timeNo2].push(item);
                    if (room.timeNo3) scheduleData[day][room.timeNo3].push(item);
                    if (room.timeNo4) scheduleData[day][room.timeNo4].push(item);
                }
            });

            // í†µê³„ ì •ë³´
            const uniqueClasses = new Set();
            professorClasses.forEach(item => {
                uniqueClasses.add(item.class.gwamokKname);
            });

            // ì‹œê°„í‘œ ìƒì„±
            let html = `<div style="margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 8px;">
                <strong>ì´ ${professorClasses.length}ê°œ ê°•ì˜ ì‹œê°„, ${uniqueClasses.size}ê°œ ê³¼ëª©</strong>
            </div>`;
            html += '<table class="room-detail-table"><thead><tr><th>êµì‹œ</th>';
            days.forEach(day => {
                html += `<th>${day}ìš”ì¼</th>`;
            });
            html += '</tr></thead><tbody>';

            for (let period = 1; period <= maxPeriod; period++) {
                html += `<tr><td class="time-header" style="background: #f8f8f8; font-weight: 600; text-align: center;">${period}êµì‹œ</td>`;
                days.forEach(day => {
                    html += '<td>';
                    const classes = scheduleData[day][period] || [];
                    if (classes.length > 0) {
                        classes.forEach(item => {
                            html += renderProfessorDetailClassItem(item.class, item.room, period);
                        });
                    }
                    html += '</td>';
                });
                html += '</tr>';
            }

            html += '</tbody></table>';
            modalProfessorContent.innerHTML = html;
            modal.style.display = 'block';
        }

        // êµìˆ˜ ìƒì„¸ ì‹œê°„í‘œìš© ê°•ì˜ ì•„ì´í…œ ë Œë”ë§
        function renderProfessorDetailClassItem(cls, room, period) {
            const periods = [];
            if (room.timeNo1) periods.push(room.timeNo1);
            if (room.timeNo2) periods.push(room.timeNo2);
            if (room.timeNo3) periods.push(room.timeNo3);
            if (room.timeNo4) periods.push(room.timeNo4);
            const timeStr = periods.sort((a,b) => a-b).join(',') + 'êµì‹œ';
            const grade = cls.openGrade || '';
            const codeName = cls.codeName1 || '';
            const stuCount = cls.sugangCount || 'íê°•';

            return `
                <div class="room-detail-class-item">
                    <div class="room-detail-class-name">${cls.gwamokKname} (${cls.bunbanNo}ë¶„ë°˜)</div>
                    <div class="room-detail-class-meta">${grade}í•™ë…„ ${codeName} (${stuCount}ëª…)</div>
                    <div class="room-detail-class-info">ğŸ“ ${room.locHname} | â° ${timeStr}</div>
                </div>
            `;
        }

        // êµìˆ˜ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeProfessorModal() {
            document.getElementById('professorModal').style.display = 'none';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
        loadData();
    </script>
</body>
</html>
